---
import { SITE_TITLE } from '../consts';
import HeaderLink from './HeaderLink.astro';
---

<header id="site-header">
	<nav>
		<h2><a href={import.meta.env.BASE_URL}>{SITE_TITLE}</a></h2>
		<div class="internal-links">
			<HeaderLink href="/">Home</HeaderLink>
			<HeaderLink href="/blog">Blog</HeaderLink>
			<HeaderLink href="/about">About</HeaderLink>
		</div>
	</nav>
</header>
<script is:inline>
  (() => {
    const header = document.getElementById('site-header');
    if (!header) return;

    let lastY = window.scrollY;
    let ticking = false;
    const MIN_DELTA = 6;       // ignora micro-miscările
    const SHOW_AT_TOP = 10;    // la începutul paginii, header-ul e mereu vizibil
    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)');

    const update = () => {
      const y = window.scrollY;
      const dy = y - lastY;

      if (Math.abs(dy) <= MIN_DELTA) {
        lastY = y; ticking = false; return;
      }
      if (y <= SHOW_AT_TOP) {
        header.classList.remove('is-hidden');
      } else if (dy > 0) {
        // derulezi în jos
        header.classList.add('is-hidden');
      } else {
        // derulezi în sus
        header.classList.remove('is-hidden');
      }
      lastY = y; ticking = false;
    };

    window.addEventListener('scroll', () => {
      if (prefersReduced.matches) return; // respectă accesibilitatea
      if (!ticking) {
        requestAnimationFrame(update);
        ticking = true;
      }
    }, { passive: true });
  })();
</script>
<style>
  header {
    position: sticky;
    top: 0;
    z-index: 50;
    margin: 0;
    padding: 0 1em;
    background: rgba(var(--black), 0.85);
    backdrop-filter: saturate(1.2) blur(6px);
    border-bottom: 1px solid rgba(255,255,255,0.06);
    box-shadow: 0 2px 8px rgba(0,0,0,0.25);

    /* nou: animatia de arătare/ascundere */
    transition: transform .28s ease;
    will-change: transform;
  }
  /* nou: când e ascuns, îl mutăm în sus în afara ecranului */
  header.is-hidden { transform: translateY(-110%); }

  h2 { margin: 0; font-size: 1em; }
  h2 a, h2 a.active { color: rgb(var(--gray-dark)); text-decoration: none; }

  nav {
    display: flex; align-items: center; justify-content: space-between;
    gap: 1em; padding: 1rem 0;
  }

  .internal-links a {
    display: inline-block; margin-right: .75rem; padding: .5rem .15rem;
    color: rgb(var(--gray)); text-decoration: none; border-bottom: 2px solid transparent;
  }
  nav a:hover { color: var(--accent); }
  nav a.active { color: var(--accent); border-bottom-color: var(--accent); text-decoration: none; }
</style>
